<script>
  (function () {
    const FILE_SYSTEM = {
      loadRoot: function () {
        const _self = this;
        google.script.run.withSuccessHandler((data) => {
          console.log({data});
          const mainDiv = document.getElementById('main');
          let fileList = document.createElement('ul');
          fileList.id = 'file-tree';
          let item = '';

          data.forEach((file) => {
            let label = `<span class="material-icons ${file.mimeClass}">${file.mimeClass}</span>`;
            item += `<li class="level collapsed ${file.type}" data-file-id="${file.id}" data-tree-level="${file.treeLevel}">${label + file.name}</li>`;
          });

          fileList.innerHTML = item;

          mainDiv.appendChild(fileList);
          _self.setOnClickHandler();
        }).getRootList();
      },

      setOnClickHandler() {
        const _self = this;
        const fileTree = document.getElementById('file-tree');

        fileTree.addEventListener('click', function(event) {
          const target = event.target;
          const fileId = target.dataset.fileId;

          if (target.classList.contains('folder')) {
            const treeLevel = target.dataset.treeLevel;
            const isExpanded = target.classList.contains('expanded');
            const folderCotents = target.querySelector('.folder-contents');
            target.classList.toggle('collapsed');
            target.classList.toggle('expanded');

            _self.getChildrenFiles(fileId,treeLevel);

            console.log('Folder clicked', fileId);
            event.stopPropagation();
          } else if (target.classList.contains('file')) {
            console.log('File opened', fileId);
            event.stopPropagation();
          }
        })
      },

      getChildrenFiles(fileId, treeLevel) {
        google.script.run.withSuccessHandler((data) => {
          console.log({data});
          
        }).getFolderContents(fileId,treeLevel);
      }
    };

    FILE_SYSTEM.loadRoot();
  })();
</script>